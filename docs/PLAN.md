# 開発計画: 分散型 GAS Wiki

## ビジョン
Google Apps Script (GAS) と Google Spreadsheets を使用した、分散型（連合型）Wikiシステムを構築する。
必要に応じてデータを取得（Pull）するのではなく、ノード（ユーザー）間で「Push型」のゴシッププロトコル（Nostr/ActivityPubに類似）を用いて更新情報を交換し、データの可用性と所有権を確保する。

## Phase 1: 連合の基礎 (ゴシッププロトコル)
目標: 2つのGASノード間で記事の更新を自動的に交換できるようにする。

- [x] **ピア管理 (Backend)**
    - [x] DBに `Peers` シートを作成し、信頼する隣人のURLを保存する。
    - [x] `addPeer`, `removePeer`, `getPeers` 関数を実装する。
- [x] **Inbox & Outbox (Backend)**
    - [x] **Outbox**: `createPage`/`updatePage` 実行時に、すべてのピアへ更新をプッシュする「ゴシップ」処理を追加する。
    - [x] **Inbox**: 外部からのJSON更新を受け付けるAPIエンドポイント (`action=gossip`) を作成する。
    - [x] **ストレージ**: 受信した外部ページを別のキャッシュ（`Cache` シート）に保存する。
- [ ] **基本認証/セキュリティ**
    - [ ] ピア間のスパムを防ぐための、シンプルな共有シークレットまたはAPIキーメカニズム。

## Phase 2: フロントエンド統合
目標: 連合の状態をUIで可視化する。

- [ ] **ピア管理 UI**
    - [x] バックエンドAPI実装完了 (`addPeer`, `getPeers`)
    - [ ] ピアURLを追加・削除するための設定ページ。
    - [ ] ピアのステータス表示（アクティブ/非アクティブ、最終同期時刻）
- [ ] **連合コンテンツ表示**
    - [ ] 検索結果に「キャッシュ済み/外部」ページを表示する。
    - [ ] 外部コンテンツであることをUIで明確に示す（例: "From: User B"）。
    - [ ] WikiLink `[UserB/PageTitle]` を、キャッシュされた外部コンテンツへ解決する。
- [x] **Alpine.js移行完了** (2026-01-17)
    - [x] React → Alpine.js 3.14.0
    - [x] Hashベースルーティング実装
    - [x] 全ページコンポーネント移行
    - [x] テーマ切り替え機能
- [ ] **現在のタスク**: ピア管理UI実装
    - [ ] ピア一覧ページの作成
    - [ ] ピア追加モーダル/フォーム
    - [ ] ピア同期ステータスの表示
    - [ ] ピア削除機能

## Phase 3: 信頼性とスケーラビリティ (リレーモデル)
目標: GASの実行制限を克服し、より大きなネットワークをサポートする。

- [ ] **非同期伝播**
    - [ ] GASトリガー（時間ベースまたはイベントベース）を使用して、Outboxキューを非同期に処理する。
    - [ ] 多数のピアへの送信によるタイムアウトを防ぐ。
- [ ] **競合解決**
    - [ ] 同時編集やバージョンの競合を処理する（例: タイムスタンプに基づく Last Write Wins）。
- [ ] **署名 (推奨)**
    - [ ] 更新の真正性を検証するための、シンプルな暗号署名（またはハッシュ検証）の実装。

## Phase 4: リレーノード
- [ ] フロントエンドUIを持たず、メッセージの保存と転送のみを行い、コミュニティのハブとして機能する特化型「リレー」モードを作成する。
